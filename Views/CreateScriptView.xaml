<UserControl x:Class="NodeLabFarm.Views.CreateScriptView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" 
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008" 
             xmlns:ui="http://schemas.lepo.co/wpfui/2022/xaml"
             xmlns:vm="clr-namespace:NodeLabFarm.ViewModels"
             mc:Ignorable="d" 
             d:DesignHeight="800" d:DesignWidth="800">
    <UserControl.DataContext>
        <vm:CreateScriptViewModel/>
    </UserControl.DataContext>
    
    <Grid Margin="0,0,24,0">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/> <!-- Header -->
            <RowDefinition Height="*"/>    <!-- Content -->
            <RowDefinition Height="Auto"/> <!-- Footer Actions -->
        </Grid.RowDefinitions>

        <!-- Header -->
        <Grid Grid.Row="0" Margin="0,0,0,24">
            <TextBlock Text="Create Script" FontSize="32" FontWeight="Bold" Foreground="White" VerticalAlignment="Center"/>
            <ui:Button Content="Script Library" Icon="Collections24" Appearance="Primary" HorizontalAlignment="Right" VerticalAlignment="Center" Padding="16,8"/>
        </Grid>

        <ScrollViewer Grid.Row="1" VerticalScrollBarVisibility="Auto">
            <StackPanel>
                <!-- Script Settings Section -->
                <ui:Card Padding="20" Background="#1a1c23" BorderThickness="1" BorderBrush="#2d2f39">
                    <StackPanel>
                        <StackPanel Orientation="Horizontal" Margin="0,0,0,16">
                            <ui:SymbolIcon Symbol="Settings24" FontSize="18" Foreground="#9ca3af" Margin="0,0,8,0"/>
                            <TextBlock Text="Script Settings" FontSize="16" FontWeight="SemiBold" Foreground="White"/>
                        </StackPanel>

                        <Grid Margin="0,0,0,12">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="120"/>
                                <ColumnDefinition Width="*"/>
                            </Grid.ColumnDefinitions>
                            <TextBlock Text="Script Name" VerticalAlignment="Center" Foreground="#9ca3af"/>
                            <ui:TextBox Grid.Column="1" Text="{Binding Script.Name}" PlaceholderText="Enter script name..."/>
                        </Grid>

                        <Grid Margin="0,0,0,12">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="120"/>
                                <ColumnDefinition Width="*"/>
                            </Grid.ColumnDefinitions>
                            <TextBlock Text="Description" VerticalAlignment="Top" Margin="0,8,0,0" Foreground="#9ca3af"/>
                            <ui:TextBox Grid.Column="1" Text="{Binding Script.Description}" PlaceholderText="Enter script description..." 
                                        MinHeight="80" AcceptsReturn="True" TextWrapping="Wrap"/>
                        </Grid>

                        <Grid>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="120"/>
                                <ColumnDefinition Width="*"/>
                            </Grid.ColumnDefinitions>
                            <TextBlock Text="Select Devices" VerticalAlignment="Center" Foreground="#9ca3af"/>
                            <StackPanel Grid.Column="1" Orientation="Horizontal">
                                <ui:Button Content="Samsung Galaxy S21" Margin="0,0,4,0" Appearance="Secondary" FontSize="11"/>
                                <ui:Button Content="Google Pixel 6" Appearance="Secondary" FontSize="11"/>
                                <ui:Button Icon="Phone24" Margin="4,0,0,0" Appearance="Secondary"/>
                            </StackPanel>
                        </Grid>
                    </StackPanel>
                </ui:Card>

                <!-- Script Steps Section -->
                <StackPanel Margin="0,24,0,0">
                    <StackPanel Orientation="Horizontal" Margin="0,0,0,16">
                        <ui:SymbolIcon Symbol="List24" FontSize="18" Foreground="#9ca3af" Margin="0,0,8,0"/>
                        <TextBlock Text="Script Steps" FontSize="16" FontWeight="SemiBold" Foreground="White"/>
                    </StackPanel>

                    <ItemsControl ItemsSource="{Binding Script.Steps}">
                        <ItemsControl.ItemTemplate>
                            <DataTemplate>
                                <ui:Card Margin="0,0,0,8" Padding="12" Background="#161a2b" BorderThickness="0">
                                    <Grid>
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="Auto"/> <!-- Handle -->
                                            <ColumnDefinition Width="Auto"/> <!-- Icon -->
                                            <ColumnDefinition Width="*"/>    <!-- Text -->
                                            <ColumnDefinition Width="Auto"/> <!-- Delay -->
                                            <ColumnDefinition Width="Auto"/> <!-- Timeout -->
                                            <ColumnDefinition Width="Auto"/> <!-- Actions -->
                                        </Grid.ColumnDefinitions>

                                        <ui:SymbolIcon Grid.Column="0" Symbol="MoreVertical24" Foreground="#2d2f39" Margin="0,0,12,0"/>
                                        
                                        <Border Grid.Column="1" Background="#2a334c" Width="32" Height="32" CornerRadius="6" Margin="0,0,12,0">
                                            <ui:SymbolIcon Symbol="{Binding Icon}" FontSize="18" Foreground="White"/>
                                        </Border>

                                        <TextBlock Grid.Column="2" Text="{Binding DisplayName}" VerticalAlignment="Center" Foreground="White" FontSize="13"/>

                                        <ui:Button Grid.Column="3" Content="{Binding Delay}" Appearance="Secondary" Margin="0,0,8,0" FontSize="11" Width="120"/>
                                        <ui:Button Grid.Column="4" Content="{Binding Timeout}" Appearance="Secondary" Margin="0,0,8,0" FontSize="11" Width="80"/>
                                        
                                        <StackPanel Grid.Column="5" Orientation="Horizontal">
                                            <ui:Button Content="Edit" Appearance="Secondary" Margin="0,0,4,0" FontSize="11"/>
                                            <ui:Button Icon="Settings24" Appearance="Secondary" Padding="4"/>
                                        </StackPanel>
                                    </Grid>
                                </ui:Card>
                            </DataTemplate>
                        </ItemsControl.ItemTemplate>
                    </ItemsControl>

                    <ui:Button Command="{Binding AddStepCommand}" Content="Add Step" Icon="Add24" Appearance="Secondary" Margin="0,8,0,0" Padding="16,8"/>
                </StackPanel>

                <CheckBox Content="Randomize Step Order" IsChecked="False" Margin="0,16,0,0" Foreground="#9ca3af"/>
            </StackPanel>
        </ScrollViewer>

        <!-- Footer Actions -->
        <StackPanel Grid.Row="2" Orientation="Horizontal" HorizontalAlignment="Right" Margin="0,24,0,0">
            <ui:Button Command="{Binding SaveCommand}" Content="Save Script" Icon="Save24" Appearance="Primary" Padding="24,10" Margin="0,0,12,0"/>
            <ui:Button Command="{Binding CancelCommand}" Content="Cancel" Appearance="Secondary" Padding="24,10"/>
        </StackPanel>
    </Grid>
</UserControl>
