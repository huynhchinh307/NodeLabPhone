<ui:FluentWindow x:Class="NodeLabFarm.LoginWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:ui="http://schemas.lepo.co/wpfui/2022/xaml"
        xmlns:vm="clr-namespace:NodeLabFarm.ViewModels"
        xmlns:local="clr-namespace:NodeLabFarm"
        mc:Ignorable="d"
        Title="NodeLab Farm - Đăng nhập" Height="720" Width="1100"
        WindowStartupLocation="CenterScreen"
        ResizeMode="NoResize"
        ExtendsContentIntoTitleBar="True"
        WindowBackdropType="Mica"
        Background="#050505"
        Icon="/Assets/app_icon.png">
    
    <ui:FluentWindow.Resources>
        <BooleanToVisibilityConverter x:Key="BooleanToVisibilityConverter"/>
    </ui:FluentWindow.Resources>

    <Window.DataContext>
        <vm:LoginViewModel/>
    </Window.DataContext>

    <Grid>
        <!-- Background Image with Professional Darkened Overlay -->
        <Grid>
            <Image Source="/Assets/login_bg_v4.png" Stretch="UniformToFill" HorizontalAlignment="Center" VerticalAlignment="Center"/>
            <Border Background="#B3000000"/> <!-- Fixed darkening at #B3 (70%) for perfect text readability -->
        </Grid>

        <Grid>
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/> <!-- TitleBar -->
                <RowDefinition Height="*"/>
            </Grid.RowDefinitions>

            <ui:TitleBar Grid.Row="0" Title="NodeLab Farm" Foreground="#cccccc" Background="Transparent"/> 

            <Grid Grid.Row="1">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="500"/>
                </Grid.ColumnDefinitions>

                <!-- Left Side: Branding/Identity -->
                <StackPanel Grid.Column="0" VerticalAlignment="Center" Margin="100,0,0,0">
                    <Image Source="/Assets/pig.png" Width="110" Height="110" HorizontalAlignment="Left" Margin="0,0,0,32"/>
                    <TextBlock Text="NodeLab Farm" FontSize="48" FontWeight="Bold" Foreground="White" Margin="0,0,0,16">
                        <TextBlock.Effect>
                            <DropShadowEffect BlurRadius="15" ShadowDepth="2" Opacity="0.6"/>
                        </TextBlock.Effect>
                    </TextBlock>
                    <TextBlock Text="Giải pháp tối ưu cho việc vận hành và quản lý hàng loạt thiết bị Android. Hiệu suất cao, độ trễ cực thấp." 
                               FontSize="19" Foreground="#e0e0e0" TextWrapping="Wrap" MaxWidth="450" HorizontalAlignment="Left" LineHeight="28">
                        <TextBlock.Effect>
                            <DropShadowEffect BlurRadius="8" ShadowDepth="1" Opacity="0.4"/>
                        </TextBlock.Effect>
                    </TextBlock>
                    
                    <StackPanel Orientation="Horizontal" Margin="0,64,0,0">
                        <StackPanel Margin="0,0,54,0">
                            <TextBlock Text="1,000+" FontSize="28" FontWeight="Bold" Foreground="White"/>
                            <TextBlock Text="Số thiết bị đồng thời" FontSize="14" Foreground="#bbbbbb" Margin="0,4,0,0"/>
                        </StackPanel>
                        <StackPanel Margin="0,0,54,0">
                            <TextBlock Text="Miễn phí" FontSize="28" FontWeight="Bold" Foreground="White"/>
                            <TextBlock Text="Chi phí" FontSize="14" Foreground="#bbbbbb" Margin="0,4,0,0"/>
                        </StackPanel>
                        <StackPanel>
                            <TextBlock Text="Scrcpy 2.x" FontSize="28" FontWeight="Bold" Foreground="White"/>
                            <TextBlock Text="Công Nghệ Mirror" FontSize="14" Foreground="#bbbbbb" Margin="0,4,0,0"/>
                        </StackPanel>
                    </StackPanel>

                    <!-- Version & Update Area -->
                    <StackPanel Orientation="Horizontal" Margin="0,100,0,0" VerticalAlignment="Bottom">
                        <TextBlock Text="{Binding Version}" Foreground="#888888" FontSize="13" VerticalAlignment="Center"/>
                        <Border Width="1" Height="14" Background="#33ffffff" Margin="16,0"/>
                        <ui:Button Appearance="Secondary" Padding="0" Background="Transparent" BorderThickness="0"
                                   Command="{Binding CheckUpdateCommand}">
                            <TextBlock Text="Kiểm tra phiên bản mới" Foreground="White" FontSize="13" FontWeight="SemiBold" TextDecorations="Underline"/>
                        </ui:Button>
                    </StackPanel>
                </StackPanel>

                <!-- Right Side: Login Card -->
                <Grid Grid.Column="1" HorizontalAlignment="Right" VerticalAlignment="Stretch" Width="500" Background="#0AFFFFFF">
                    <Border BorderBrush="#1AFFFFFF" BorderThickness="1,0,0,0"/>
                    
                    <StackPanel VerticalAlignment="Center" Margin="70">
                        <TextBlock Text="Đăng nhập" FontSize="32" FontWeight="Bold" Foreground="White" Margin="0,0,0,10"/>

                        <!-- Form -->
                        <ui:TextBox PlaceholderText="Tên tài khoản" 
                                    FontSize="15"
                                    Height="37"
                                    Text="{Binding Username, UpdateSourceTrigger=PropertyChanged}" 
                                    Margin="0,0,0,16">
                            <ui:TextBox.Icon>
                                <ui:SymbolIcon Symbol="Person24"/>
                            </ui:TextBox.Icon>
                        </ui:TextBox>
                        
                        <ui:PasswordBox x:Name="PasswordBox" 
                                        PlaceholderText="Mật khẩu bảo mật" 
                                        FontSize="15"
                                        Height="52"
                                        Margin="0,0,0,16">
                            <ui:PasswordBox.Icon>
                                <ui:SymbolIcon Symbol="LockClosed24"/>
                            </ui:PasswordBox.Icon>
                        </ui:PasswordBox>

                        <ui:Button Appearance="Secondary" Content="Thiết lập lại mật khẩu?" 
                                   Padding="0" HorizontalAlignment="Right" Background="Transparent" BorderThickness="0" Margin="0,0,0,32">
                            <ui:Button.Style>
                                <Style TargetType="ui:Button" BasedOn="{StaticResource {x:Type ui:Button}}">
                                    <Setter Property="Foreground" Value="#888888"/>
                                    <Style.Triggers>
                                        <Trigger Property="IsMouseOver" Value="True">
                                            <Setter Property="Foreground" Value="White"/>
                                        </Trigger>
                                    </Style.Triggers>
                                </Style>
                            </ui:Button.Style>
                        </ui:Button>

                        <!-- Error Message - Professional Styling -->
                        <Border x:Name="ErrorBox" Background="#33FF4D4D" Padding="16,12" CornerRadius="8" Margin="0,0,0,32"
                                Visibility="{Binding HasError, Converter={StaticResource BooleanToVisibilityConverter}}">
                            <StackPanel Orientation="Horizontal">
                                <ui:SymbolIcon Symbol="DismissCircle24" Foreground="#FF4D4D" Margin="0,0,12,0" FontSize="22"/>
                                <TextBlock Text="{Binding ErrorMessage}" Foreground="#FF4D4D" FontSize="14" FontWeight="Medium" VerticalAlignment="Center" TextWrapping="Wrap"/>
                            </StackPanel>
                        </Border>

                        <ui:Button Content="Bắt đầu quản lý ngay" 
                                   FontSize="17" FontWeight="Bold"
                                   Height="56"
                                   Command="{Binding LoginCommand}" 
                                   CommandParameter="{Binding ElementName=PasswordBox}" 
                                   Appearance="Primary" 
                                   HorizontalAlignment="Stretch" 
                                   Margin="0,0,0,32">
                            <ui:Button.Style>
                                <Style TargetType="ui:Button" BasedOn="{StaticResource {x:Type ui:Button}}">
                                    <Style.Triggers>
                                        <DataTrigger Binding="{Binding IsBusy}" Value="True">
                                            <Setter Property="IsEnabled" Value="False"/>
                                            <Setter Property="Content" Value="Đang kết nối server..."/>
                                        </DataTrigger>
                                    </Style.Triggers>
                                </Style>
                            </ui:Button.Style>
                        </ui:Button>
                        
                        <ui:Button Content="Thoát khỏi chương trình" 
                                   Command="{Binding CloseCommand}" 
                                   Appearance="Secondary" 
                                   FontSize="15"
                                   Height="48"
                                   HorizontalAlignment="Stretch"/>

                        <TextBlock Text="NodeLab Farm v1.0.2 Stable © 2026" 
                                   FontSize="12" Foreground="#ff0967ff" Margin="0,100,0,0" HorizontalAlignment="Center"/>
                    </StackPanel>
                </Grid>
            </Grid>
        </Grid>
        <!-- Modern Loading Overlay for Login -->
        <Grid IsHitTestVisible="True" Panel.ZIndex="1000">
            <Grid.Style>
                <Style TargetType="Grid">
                    <Setter Property="Visibility" Value="Collapsed"/>
                    <Setter Property="Opacity" Value="0"/>
                    <Style.Triggers>
                        <DataTrigger Binding="{Binding IsBusy}" Value="True">
                            <Setter Property="Visibility" Value="Visible"/>
                                <DataTrigger.EnterActions>
                                    <BeginStoryboard>
                                        <Storyboard>
                                            <DoubleAnimation Storyboard.TargetProperty="Opacity" From="0" To="1" Duration="0:0:0.3"/>
                                        </Storyboard>
                                    </BeginStoryboard>
                                </DataTrigger.EnterActions>
                                <DataTrigger.ExitActions>
                                    <BeginStoryboard>
                                        <Storyboard>
                                            <DoubleAnimation Storyboard.TargetProperty="Opacity" From="1" To="0" Duration="0:0:0.3"/>
                                        </Storyboard>
                                    </BeginStoryboard>
                                </DataTrigger.ExitActions>
                            </DataTrigger>
                    </Style.Triggers>
                </Style>
            </Grid.Style>
            
            <Border Background="#CC000000" CornerRadius="0">
                <Border.Effect>
                    <BlurEffect Radius="20"/>
                </Border.Effect>
            </Border>

            <StackPanel VerticalAlignment="Center" HorizontalAlignment="Center">
                <ui:ProgressRing IsIndeterminate="True" Width="80" Height="80" Foreground="#3B82F6"/>
                <TextBlock Text="Đang xác thực thông tin..." 
                           Foreground="White" 
                           FontSize="18" 
                           Margin="0,24,0,0" 
                           FontWeight="SemiBold"
                           HorizontalAlignment="Center">
                    <TextBlock.Effect>
                        <DropShadowEffect BlurRadius="10" ShadowDepth="0" Color="#3B82F6" Opacity="0.5"/>
                    </TextBlock.Effect>
                </TextBlock>
                <TextBlock Text="Vui lòng đợi trong giây lát" 
                           Foreground="#94A3B8" 
                           FontSize="14" 
                           Margin="0,8,0,0" 
                           HorizontalAlignment="Center"
                           Opacity="0.8"/>
            </StackPanel>
        </Grid>
    </Grid>
</ui:FluentWindow>
